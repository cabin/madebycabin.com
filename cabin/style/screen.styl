@import nib
@import default
@import util

cabin_black = #2b2b2b
cabin_grey_dark = #929292
cabin_grey_med = #d2d2d2
cabin_grey_light = #f2f2f2
cabin_mustard = #edbc13
cabin_bronze = #ab9960
default_tap_highlight_color = rgba(26, 26, 26, 0.3)
body_font = ProximaNova, Helvetica Neue, Helvetica, sans-serif
headline_font = 'YWFT Ultramagnetic Light'  // XXX backup?
headline_size = 30px
headline_lh = 1.33
headline_height = headline_size * headline_lh
button_height = 28px


// Common  {{{1
// Site-wide defaults and functions  {{{2

body
  color: cabin_black
  font: 13px/1.23 body_font

.main .content
  clearfix()
  margin: 0 auto

a
  text-decoration: none

.headline-text
  font: headline_size/headline_lh headline_font
  text-transform: uppercase

.small-header-text
  font-weight: bold
  text-transform: uppercase

.dim-text
  color: cabin_grey_dark
  font-size: 13px
  font-weight: normal

body-text()
  font: 14px/1.3 body_font

mini-text()
  light-text()
  background: cabin_black
  color: cabin_grey_dark
  font-size: 11px
  font-weight: normal
  text-transform: uppercase

.thin-text
  font-weight: normal

h1
  @extend .headline-text
  margin: 30px 0

button, .button, .button-arrow
  @extend .small-header-text
  background: cabin_grey_light
  border: none
  border-radius: 2px
  color: cabin_black
  display: inline-block
  line-height: button_height - 2px
  padding: button_height - @line-height 12px 0
  white-space: nowrap
  &[type="submit"]
    light-text()
    background: cabin_black
    color: white
  &:hover
    light-text()
    background: cabin_bronze
    color: white
.button-arrow
  padding-right: 26px
  position: relative
  &:after
    absolute: right 12px top; bottom 0
    background-position: center center
    background-repeat: no-repeat
    content: ""
    display: block

// <div class="loading-dots"><b></b><b></b><b></b><b class="x"></b></div>
.loading-dots
  clearfix()
  font: bold 40px/10px ProximaNova
  color: cabin_grey_med
  transform: translateZ(0)  // try for GPU rendering
  b
    float: left
    width: 10px
  b:before
    content: "Â·"
    display: inline-block
  b.x
    absolute: left top
    animation-name: loading-dots
    animation-duration: 1s
    animation-timing-function: steps(1)
    animation-iteration-count: infinite
    color: cabin_bronze
@keyframes loading-dots
  0%
    left: 0
  20%
    left: 10px
  40%
    left: 20px
  60%
    visibility: hidden


// Set the overall page width either to a max value (if passed a single
// argument) or bounded between min and max widths (with two arguments).
page-width(args...)
  nav, .content, footer
    if length(args) == 1
      max-width: args[0]
    else
      min-width: args[0]
      max-width: args[1]


// Lazy man's custom checkboxes; applying these styles allows styling the input
// element as a normal element on WebKit browsers. Falls back to a normal
// checkbox in other browsers. If we need to support other browsers later,
// another option would be display: none on the checkbox, and then use sibling
// selectors to style a label.
custom-checkbox()
  -webkit-appearance: none
  border-radius: 0
  border: none
  cursor: pointer


hover-hr(duration = 200ms)
  position: relative
  hr
    absolute: top left
    background: cabin_bronze
    border: none
    margin: 0
    size: 0 1px
    transition: width duration
  .no-touch &:hover hr, &.selected hr
    width: 100%
  &.selected hr
    background: cabin_black


// Apply centered text on top of a horizontal rule, with padding. For example:
//
//     <h1><span>My heading</span></h1>
//
//     h1
//       rule-behind(span)
//
// Renders:
// ------- My heading -------
//
rule-behind(text_container_element, color = cabin_black)
  overflow: hidden
  text-align: center
  & > {text_container_element}
    position: relative
    &:before, &:after
      border-top: 1px solid color
      content: ""
      display: block
      margin: 0 1em
      position: absolute
      top: 50%
      width: 200%
    &:before
      right: 100%
    &:after
      left: 100%


// nav/splash  {{{2

body > header
  absolute: top left; right: 0
  // Absolute path here to prevent Stylus from inlining this image twice.
  background: cabin_black url(/static/splash-dots.png)
  .backgroundsize.multiplebgs &
    background-color: cabin_black
    background-image:
      url(/static/splash-dots.png), url(/static/splash.jpg)
    background-position: center center
    background-size: auto, cover
  color: white
  display: none
  overflow: hidden

  hgroup
    absolute: left 50% top 50%
    width: 420px
    margin-left: -(@width / 2)
    height: 240px
    margin-top: -(@height / 2)

  h1, h2
    margin: 0 auto
    text-align: center
  h1
    font-size: 80px
    height: 85px
    .svg.backgroundsize &
      replace-text: url('cabin-logo.svg')
      background-size: contain
  h2, h3
    color: cabin_grey_med
    letter-spacing: 1px
    text-transform: uppercase
  h2
    font: 17px/1.33 body_font
    white-space: nowrap
    // Custom linebreaks; "white-space: pre" is added for f/m classes.
    .br:before
      content: "\A"
  h3
    rule-behind(span, cabin_grey_dark)
    font: 10px/1 body_font
    margin: 23px 0

.nav-container
  background: white
  fixed: top left; right 0
  z-index: 10
nav
  user-select: none
  position: relative
  .logo
    replace-text: url('cabin-symbol.svg')
    .no-svg &
      background-image: url('cabin-symbol.png')
  .links a
    @extend .small-header-text
    color: cabin_black

// Make sure the main content is tall enough to cover the splash during
// transitions, and set up its initial position so animation works.
html, body
  height: 100%
.main
  background: white
  box-sizing: border-box
  min-height: 100%
  relative: top
  .iphone &
    margin-bottom: -60px
// Avoid page-width jump.
html
  overflow-y: scroll

body.splash
  > header
    display: block
  .main
    absolute: bottom left; top: auto
    height: 0
    min-height: @height
    overflow: hidden
    padding-bottom: 0
    width: 100%
  .nav-container, .page-about .menu
    position: absolute
  footer
    display: none

// Show everyone while transitioning.
body.splash-transition
  .nav-container, .page-about .menu
    position: absolute
  .main
    height: auto
  > header
    display: block


// Work page  {{{2

.bricks
  opacity: 0
  // masonry class is added after initial layout, so we can avoid initial
  // transitions.
  &.masonry
    opacity: 1
    transition-property: opacity, height, width
    &, .masonry-brick
      transition-duration: 300ms
      transform: translate3D(0, 0, 0)
    .masonry-brick
      transition-property: left, right, top

.work-thumb
  space_between = 80px
  hover-hr(300ms)
  border-top: 1px solid cabin_grey_light
  color cabin_black
  display: block
  float: left
  margin-bottom: (space_between / 2)
  margin-right: 20px
  padding-top: 14px
  padding-bottom: (space_between / 2)
  width: 260px

  h2, h3
    font-size: 1em
    margin: 0
  h2
    @extend .small-header-text
  h3
    @extend .dim-text
    margin-bottom: 26px
  img
    margin: 0 auto
    display: block
    max-width: 100%
    height: auto


// Project page  {{{2

.page-project
  overflow-x: hidden
  .info
    clearfix()
    margin: 30px 0 60px
  hgroup
    h1
      line-height: 1
      margin: 0 0 5px
    h2
      @extend .dim-text
      margin: 0
  .tabs *
    margin: 0
  .tab-contents
    body-text()
    > *
      display: none
    > .selected
      display: block
  a.external
    color: cabin_black
    display: inline-block
    margin-top: 10px
    .arrow-mini
      background-color: cabin_black
      vertical-align: middle
    &:hover
      color: cabin_bronze
    &:hover .arrow-mini
      background-color: cabin_bronze
  .images .placeholder
    position: relative
    .loading-dots
      absolute: left 20px top 15px
    img
      background-color: cabin_grey_light
      clear: both
      width: 100%
      margin-bottom: 60px
      vertical-align: top
      &.shadow
        border-radius: 4px 4px 0 0
        box-shadow: 0 0 2px 1px rgba(cabin_grey_dark, .2)

  .arrow-left, .arrow-right
    background-color: cabin_grey_light
    border-radius: 2px
    size: 38px button_height - 2px
    .no-touch &:hover
      background-color: cabin_bronze

  .bottom
    margin-bottom: 40px
    text-align: center

  .dev-shortlist
    margin-bottom: 60px
    visibility: hidden  // avoid FOUC

    h3, .dev-shortlist-toggle
      light-text()
      background-color: cabin_black
      border-radius: 2px
      color: white
      float: left
      text-transform: uppercase
    h3
      line-height: 30px
      margin: 0 1px 1px
      padding-right: 80px
      // Breakout left.
      margin-left: -200%
      padding-left: 200%
    .dev-shortlist-toggle
      box_width = 24
      box_height = 30
      hide-text()
      float: left
      position: relative
      size: box_width box_height
      span
        img = '../static/icons/plus-white@2x.png'
        plus_size = image-size(img)[0] / 2  // assumed square
        absolute: left ((box_width - plus_size) / 2) top ((box_height - plus_size) / 2)
        background-image: url(img)
        background-size: plus_size
        display: inline-block
        size: plus_size
        transform: rotate(45deg) scale(1.1)  // scale improves the crispness
      .no-touch &:hover
        background-color: cabin_bronze
    &.closed .dev-shortlist-toggle span
      transform: none
    &.loaded .dev-shortlist-toggle span
      transition: transform 250ms ease-in-out

    .dev-shortlist-window, li
      margin-left: -200%
      margin-right: -200%
      padding-left: 200%
      padding-right: 200%

    .dev-shortlist-window
      clear: left
      overflow: hidden
      position: relative

    &.loaded
      visibility: visible
      .dev-shortlist-window
        transition: height 300ms ease-in-out
      ul
        transition: top 300ms ease-in-out

    ul
      light-text()
      color: white
      font: 60px/2 headline_font
      list-style: none
      margin: 0
      padding: 0
      position: absolute
      text-transform: uppercase
      white-space: nowrap
      width: 100%
    li
      background: cabin_black
      // Since we're all in caps, the space for descenders leaves the text
      // feeling un-centered vertically; pad the top to account for it.
      span
        padding-top: .05em


// About page  {{{2
.page-about
  .content section
    body-text()
  hgroup
    margin-bottom: 1em
    h2
      @extend h1
      line-height: 1
      margin: 0 0 5px
    h3
      @extend .dim-text
      margin: 0
  .bio .social
    clearfix()
    a
      background-color: cabin_black
      float: left
      margin-right: 5px
      .no-touch &:hover
        background-color: cabin_bronze
  .graph
    .svg
      white-space: nowrap
      svg
        vertical-align: top
        display: inline-block
        .selected
          &, path.main, text
            fill: cabin_bronze
          path.highlight
            fill: #b8a878
          &, g
            fill-opacity: 1
    .notes
      display: none
    // XXX fallback png for lame-os
  // Hide these until their image stylesheet is loaded.
  .clients a
    display: none


// Error pages  {{{2
.page-error
  h1
    font-size: 80px
    margin-bottom: 40px
    line-height: 1
  h2
    font: headline_size/1 headline_font
    text-transform: uppercase
  .error-block
    position: relative
    padding-left: 120px
  .code
    absolute: left top
    border-top: 1px solid cabin_black
    font-weight: bold
    line-height: 30px
    width: 80px
  .button, .button-arrow
    light-text()
    background-color: cabin_black
    color: white
    float: left
    margin: 0 5px 10px 0
    &:hover
      background-color: cabin_bronze


// <= iPhone 5 landscape  {{{1
@media only screen and (max-width: 568px)
  // nav/splash  {{{2
  nav_height = 40px

  nav
    border-bottom: 1px solid cabin_grey_light
    display: table
    width: 100%
    height: nav_height
    box-shadow: 0 0 2px 2px transparent
    transition-properties: box-shadow, border
    transition-duration: 500ms
    transition-timing-function: ease-in-out
    .scrolled &
      border-bottom-color: transparent
      box-shadow: 0 0 2px 2px rgba(cabin_grey_dark, .3)

    .logo
      background-size: 18px 15px
      background-position: center 12px
      display: table-cell
      text-indent: -999px
      width: 25%
    .links
      display: table
      table-layout: fixed
      margin-bottom: -1px  // Account for the extra-height children.
      width: 100%
      a
        border-left: 1px solid cabin_grey_light
        display: table-cell
        text-align: center
        // Offset for the non-centered font.
        padding-top: 3px
        line-height: nav_height - @padding-top
        // Extend the left border over the container's bottom border; that
        // allows us to replace the bottom border with a box shadow without
        // an awkward gap.
        height: nav_height - @padding-top + 1
    .toggle, .social
      display: none

  body > header
    bottom: nav_height
  .main
    padding-top: nav_height
  .content
    padding: 0 20px

  body > header hgroup
    width: 240px
    margin-left: -(@width / 2)
    height: 160px
    margin-top: -(@height / 2)
    h1
      font-size: 45px
      height: 50px
    h2
      font-size: 14px
    h3
      margin: 17px 0
    .br.m
      white-space: pre

  footer
    display: none


  // Work page  {{{2
  breakout(page_padding = 20px)
    padding-left: page_padding
    padding-right: page_padding
    margin-left: -(page_padding)
    margin-right: -(page_padding)

  .single-column .work-thumb
    breakout()


  // Project page  {{{2
  .page-project
    .prev-next, .bottom .social
      display: none

    .dev-shortlist h3
      mini-text()
      line-height: 28px
      padding-top: 2px


  // About page  {{{2
  .page-about
    .menu
      clearfix()
      mini-text()
      fixed: left 0 top nav_height; right 0
      text-align: center
      user-select: none
      z-index: 2
      a
        float: left
        line-height: 37px
        padding-top: 40 - @line-height  // adjust for all-caps
        width: 30%
        &:nth-child(2)
          width: 40%
      .arrow
        absolute: left top 100%
        border: 9px solid transparent
        border-top-color: cabin_black
        display: none
        margin-left: -9px  // offset so `left` can position the center
        size: 0 0
        transition: left 200ms ease-in-out

    .content > h1, .sections section, .sections section > h1
      display: none
    .sections
      clearfix()
      margin-top: 40px  // .menu
      padding-bottom: 20px
      section.selected
        display: block

    section.partners .bio
      breakout()
      hgroup
        breakout()
        height: 65px
        background-color: cabin_grey_dark
        background-size: cover
        margin-bottom: 1px
        position: relative
        padding-top: 25px
        h2, h3
          light-text()
          color: white
          margin: 0
        h2
          font-size: 24px
        h3
          body-text()
        .toggle
          img = 'icons/plus-about@2x.png'
          s = image-size(img)
          absolute: right 20px top 30px
          display: inline-block
          background-size: (s[0] / 2) (s[1] / 2)
          replace-text: url(img)
          size: (s[0] / 2) (s[1] / 2)
          transition: transform 250ms ease-in-out
      // XXX should be using a cssrewrite filter instead of hardcoded
      &.bek hgroup
        background-image: url(/static/photos/bek-stripe@2x.jpg)
      &.zak hgroup
        background-image: url(/static/photos/zak-stripe@2x.jpg)
      .social
        margin-bottom: 20px
      p, .social
        display: none
      &.open
        p, .social
          display: block
        .toggle
          transform: rotate(45deg)

    section.graph
      breakout()
      border-top: 1px solid cabin_grey_light
      padding-top: 20px
      > h2
        display: none
      hgroup
        h2, h3
          margin: 0
        h2
          font-size: 24px
          line-height: 1
        h3
          body-text()
      .notes
        margin-top: 20px

    section.clients
      breakout()
      div
        breakout()
        border-bottom: 1px solid cabin_grey_dark
        box-shadow: inset 0 -2px 2px -1px rgba(cabin_grey_dark, .5)
        height: 50px
        margin-bottom: 20px
        padding-bottom: 20px
        padding-top: 20px
        white-space: nowrap
        overflow-x: scroll
        -webkit-overflow-scrolling: touch
      a
        background-color: cabin_grey_dark
        margin-left: 20px
        &:first-child
          margin-left: 0
      // Fake the grey background.
      position: relative
      &:after
        absolute: left top; bottom 0; width: 100%
        background: cabin_grey_dark
        content: ""
        display: block
        opacity: .5
        pointer-events: none

    section.services
      ol
        font-weight: bold
        list-style: none
        margin: 0
        padding: 0
        ol
          body-text()
          margin: 5px 0 20px
          li
            display: inline
            &:before
              content: ",\0020"
            &:first-child:before
              content: ""

    section.connect
      ol
        list-style: none
        margin: 0
        padding: 0
      li
        breakout()
        border-bottom: 1px solid cabin_grey_light
        font: 40px headline_font
        line-height: 87px
        padding-top: (90px - @line-height)  // correct not-quite-centered font
        padding-left: 60px
        position: relative
        text-transform: uppercase
      li:before
        absolute: left 20px top 32px
        background-color: cabin_black
        content: ""
        display: block
        outline: 1px solid white
      a
        color: cabin_black
        display: block


// > iPhone 5 landscape  {{{1
@media only screen and (min-width: 569px)
  // Common  {{{2
  nav_height = 90px
  footer_height = 60px

  .nav-container
    box-shadow: 0 0 2px 2px rgba(cabin_grey_dark, .3)
  nav
    height: (nav_height / 3)
    line-height: @height
    padding: @height
    margin: 0 auto

    .logo
      background-size: 35px 30px
      float: left
      size: 35px 30px
    .links
      float: right
      overflow: hidden
      padding-right: 20px  // account for the toggle
      position: relative
      > a
        float: left
        margin-right: 20px
        padding: 0 10px
        &:hover
          color: cabin_bronze

    .social
      transition_duration = 400ms
      absolute: left 100% top
      background: white
      transition: left transition_duration
      white-space: nowrap
      width: 100%
      a
        background-color: cabin_black
        float: left
        margin-right: 10px
        relative: left 100% top
        transition: left transition_duration ease transition_duration
        &:hover
          background-color: cabin_bronze
      a:first-child
        left: 0
    // Inside the toggle is a `b` used for creating a little border on hover,
    // and a `span` element for holding the plus image so it can be rotated
    // independently of the container.
    .toggle
      padding = 10px
      absolute: right (nav_height / 3 - padding) top (nav_height / 3)
      background: white
      border-left: 1px solid white
      padding: 0 padding
      transition: border-color 500ms
      .no-touch &:hover
        border-color: cabin_grey_med
      span
        img = 'icons/plus@2x.png'
        replace-text: url(img)
        size: (image-size(img)[0] / 2) (image-size(img)[1] / 2)
        background-size: @width @height
        display: inline-block
        transition: transform 250ms ease-in-out 200ms
      &.transitioning
        transition-delay: 400ms
    .touch & .toggle
      &.transitioning
        border-color: cabin_grey_med
        transition-delay: 0

    &.show-social
      .social
        &, a
          left: 0
          transition-delay: 0
        a:nth-child(2)
          transition-delay: 100ms
        a:nth-child(3)
          transition-delay: 200ms
        a:nth-child(4)
          transition-delay: 300ms
        a:nth-child(5)
          transition-delay: 400ms
        a:nth-child(6)
          transition-delay: 500ms
      .toggle span
        // Scale is increased to improve diagonal line visibility.
        transform: rotate(45deg) scale(1.1)
        backface-visibility: hidden

  body > header
    bottom: nav_height
  .main
    padding: 0 30px
    padding-top: nav_height
    padding-bottom: footer_height + 40px

  body > header .br.f
    white-space: pre

  .footer-container
    absolute: bottom left; right: 0
    background: cabin_grey_light
    box-shadow: inset 0 2px 2px -2px cabin_grey_dark
  footer
    height: footer_height
    line-height: @height
    margin: 0 auto
    overflow: hidden
    padding: 0 30px
    &, a
      color: cabin_grey_dark
    span
      color: cabin_grey_med
      display: inline-block
      margin: 0 5px
    ol
      inline-list()
    .copyright
      float: right
      margin: 0
      text-transform: uppercase
    .logout
      float: right
      margin: 21px 20px 0 0
      opacity: .2
      &:hover
        opacity: 1

  .photo
    background-color: white
    background-position: center center
    background-repeat: no-repeat
    background-size: 400px 400px
    display: block
    padding: 5px
    size: 400px
    &.shadow-left:before
      img = 'photos/shadow-left.png'
      s = image-size(img)
      absolute: left -7px bottom -18px
      background-image: url(img)
      background-position: left bottom
      background-repeat: no-repeat
      content: ""
      display: block
      size: s[0] s[1]
    &.shadow-right:before
      img = 'photos/shadow-right.png'
      s = image-size(img)
      absolute: right -7px bottom -18px
      background-image: url(img)
      background-position: right bottom
      background-repeat: no-repeat
      content: ""
      display: block
      size: s[0] s[1]


  // Work page  {{{2

  .page-work
    .work-thumb
      &.feature
        width: 540px
      // Cover the top border with the hover-hr.
      hr
        top: -1px


  // Project detail page  {{{2

  .page-project
    page-width(1100px)

    .tab-chooser a
      hover-hr()
      light-text()
      border-top: 1px solid cabin_grey_light
      color: cabin_grey_med
      display: block
      line-height: 30px
      // @extend .small-header-text -- can't work inside a media query
      font-weight: bold
      text-transform: uppercase
      // Cover the top border with the hover-hr.
      hr { top: -1px }
      &.selected, .no-touch &:hover
        light-text('reset')
        color: cabin_black
      &.selected
        cursor: default

    .services
      font-weight: bold
      &, ol
        list-style: none
        padding: 0
      > li
        float: left
        margin-left: 20px
        width: 160px
        &:first-child
          margin-left: 0
      ol
        font-weight: normal
        margin-top: 5px

    .cohorts
      td
        vertical-align: bottom
      td:first-child
        padding-right: 50px
      a
        color: cabin_black
        display: block
      .twitter
        background-color: cabin_grey_med
        margin-right: 5px
        relative: top 2px left
      a:hover .twitter
        background-color: cabin_black

    .info
      position: relative
      .prev-next
        absolute: top right
    hgroup
      float: left
      width: 280px
    .tabs
      clearfix()
      border-right: 1px solid cabin_grey_light
      height: 150px
      margin-right: 100px
      padding-right: 39px
      > div
        float: right
    .tab-chooser
      width: 80px
      margin-right: 40px
    .tab-contents
      width: 520px

    .dev-shortlist h3
      font-size: 13px

    .bottom
      position: relative
      a, .social
        vertical-align: top
      .social
        display: inline-block
        margin: 0 15px 0 10px
        > a
          float: left
          margin-left: 5px
          background-color: black
          &:hover, &.selected
            background-color: cabin_bronze

      .pinterest-image-picker
        absolute: bottom 100% left 50%
        margin-bottom: 20px

        // To create the bottom-pointing arrow with an uninterrupted box shadow
        // and border, we use three layers. The container box is used as the
        // background layer, and gets the border+shadow. Then is a small square
        // (`&:before`) used for the arrow, which gets the same treatments. On
        // top is a second container (`> div`) which holds the content and has
        // a background color to hide the unwanted portion of the arrow's box.
        &  // , > div (radiusing the inner container caused a hole
          border-radius: 2px
        &, &:before
          box-shadow: 0 0 3px 0 rgba(cabin_black, 0.2)
          border: cabin_grey_med
        &:before, > div
          background: cabin_grey_light
        > div
          clearfix()
          padding: 10px 30px 30px 10px
          transform: translateZ(0)  // z-index hack
        &:before
          absolute: left 50% top 100%
          content: ""
          display: block
          transform: rotate(45deg)
          width: 10px
          height: @width
          margin-top: -(@height / 2 + 1)
          margin-left: 30px - (@width / 2)  // center on the pinterest icon

        a
          outline: 1px solid cabin_grey_med
          float: left
          margin: 20px 0 0 20px
          min-height: 85px
          max-height: 170px
          overflow: hidden
          position: relative
          width: 170px
          img
            max-width: 100%
            max-height: 100%
          .button
            light-text()
            display: none
            background-color: cabin_black
            color: white
            absolute: left 50% top 50%
            margin-top: -(button_height / 2)
            width: 60px
            padding-left: 0
            padding-right: 0
            margin-left: -(@width / 2)
        a:hover
          img
            opacity: .3
          .button
            display: block


  // About page  {{{2

  .page-about
    page-width(1100px)
    overflow-x: hidden

    breakout()
      margin-left: -200%
      margin-right: -200%
      padding-left: 200%
      padding-right: 200%

    .menu
      display: none

    .content > h1
      font-size: 80px
      line-height: 1.1
      width: auto

    .content section
      clear: both
      padding-left: 80px + 40px
      position: relative
      > h1
        absolute: top left
        border-top: 1px solid cabin_black
        font: bold 13px body_font
        line-height: 30px
        margin: 0
        width: 80px
      p
        margin: 0 0 1em

    .content
      position: relative
      .photo
        position: absolute
        &.bek
          background-image: url(/static/photos/bek.jpg)
          left: -140px; top: 410px
          transform: rotate(15deg)
        &.zak
          background-image: url(/static/photos/zak.jpg)
          right: -120px; top: -145px
          transform: rotate(-30deg)

    section.summary
      > h1
        font-family: Georgia, serif
        font-size: 20px
      .email
        light-text()
        background: cabin_bronze
        color: white
        text-transform: none
        &:hover
          background: cabin_black

    .summary, .partners
      float: right
      margin-top: 60px
      max-width: 80px + 40px + 630px - (80 + 40)

    .partners
      margin-bottom: 60px
      .bio
        float: left
        width: 47%
        padding-bottom: 30px
        &:first-of-type
          margin-right: 6%
      .social
        position: absolute
        bottom: 0

    section.graph
      breakout()
      background: #ebebe7  // XXX
      box-shadow: inset 0 0 3px 2px rgba(cabin_grey_dark, .3)
      min-height: 400px
      padding-top: 40px
      padding-bottom: 60px
      h2
        font: 40px/1.1 headline_font
        margin: 0
        text-transform: uppercase
      hgroup.small
        display: none
      .notes
        margin-top: 30px
        position: absolute
        top: 120px
        .year
          absolute: left top
          border-top: 1px solid cabin_black
          font-weight: bold
          line-height: 30px
          width: 80px
        .note
          margin-left: 120px
          width: 300px

    section.clients
      breakout()
      box-shadow: 0 2px 3px 0 rgba(cabin_grey_dark, .3)
      padding-top: 40px
      padding-bottom: 40px
      z-index: 2

      > h1
        float: left
        margin-right: 40px
        margin-top: 10px
        position: static
      > div
        height: 50px
        overflow: hidden
        white-space: nowrap
      a
        background-color: cabin_bronze
        float: left
        margin-left: 27px
        &:first-child
          margin-left: 0
        &:hover
          background-color: cabin_black

    section.services
      font-size: 13px
      float: left
      margin-top: 50px
      ol.services
        font-weight: bold
        margin: 0
        &, ol
          list-style: none
          padding: 0
        > li
          float: left
          margin-left: 20px
          width: 160px
          &:first-child
            margin-left: 0
        ol
          font-weight: normal
          margin-top: 5px

    section.colophon
      background-color: cabin_black
      clear: none
      color: white
      float: right
      margin-bottom: -50px
      padding: 50px 20px
      width: 300px
      > h1
        light-text()
        border-top-color: white
        position: relative
        top: -7px
      .signature
        img = 'signed-cabin.png'
        background-image: url(img)
        s = image-size(img)
        background-size: s[0] s[1]
        size: s[0] s[1]

    section.connect
      display: none


  // Error pages  {{{2
  .page-error
    page-width(1100px)
    overflow: hidden
    .content
      position: relative
    h1
      min-height: 220px
      position: relative
    .photo
      position: absolute
      z-index: 0
      &.wing-belly
        background-image: url(/static/photos/wing-belly.jpg)
        right: -100px
        top: -140px
        transform: rotate(-30deg)
      &.wing-flop
        background-image: url(/static/photos/wing-flop.jpg)
        right: -100px
        top: -100px
        transform: rotate(-15deg)
      &.wing-yawn
        background-image: url(/static/photos/wing-yawn.jpg)
        right: -100px
        top: -20px
        transform: rotate(-30deg)


  // Admin  {{{2
  // TODO: Consider pulling this out into its own stylesheet; load it only if
  // the user is logged in.

  .page-admin-project
    page-width(940px, 1100px)
    input_height = 38px

    form *
      box-sizing: border-box

    .header
      clearfix()
      h1
        float: left
      aside
        float: right
        margin: headline_height 0

    input[type="text"], textarea, .thumbnail figure, .dropper
      background: cabin_grey_light
      border: none
      box-shadow: inset 1px 1px 1px 0 rgba(cabin_grey_dark, .2)
      display: block
      outline: none
      padding: 10px
      &:focus
        outline: 1px solid cabin_grey_dark
      &.error
        outline: 1px solid red
    textarea
      resize: none
    ::-webkit-input-placeholder
      light-text()
      color: cabin_grey_med

    fieldset
      border: none
      margin: 0
      padding: 0
    form > fieldset
      margin-bottom: 20px
      padding-left: 120px
      position: relative
      > legend
        absolute: top left
        border-top: 1px solid cabin_black
        font-weight: bold
        line-height: 30px
        text-transform: uppercase
        width: 80px

    [name="is_public"], [name="is_featured"]
      custom-checkbox()
      position: relative
    [name="is_public"]
      background-color: cabin_mustard
      margin-right: 10px
      top: 3px
      &:checked
        background-color: grey
    [name="is_featured"]
      background-color: grey
      margin-right: 20px
      top: 4px
      &:checked
        background-color: cabin_mustard

    [name="title"]
      float: left
      font: headline_size/headline_lh headline_font
      size: 280 + 10*2 100  // match display width
      text-transform: uppercase
    [name="type"], [name="slug"]
      float: left
      width: 940px - 120 - 300 - 20
      margin-left: 20px
    [name="type"]
      margin-bottom: 100px - input_height * 2
    [name="brief"]
      margin-bottom: 10px
      size: 520 + 10*2 150 + 10*2 // match display size
    [name="external_url"]
      width: 420px

    [name="brief"], .services fieldset, .cohorts input
      body-text()

    .thumbnail figure, .images .dropper
      background: cabin_grey_med
      display: inline-block
      position: relative
      padding: 0
      width: 260px
      figcaption
        light-text()
        absolute: top 40% left 50%
        color: cabin_grey_med
        text-align: center
        width: 200px
        margin-left: -(@width / 2)
        span
          background-color: cabin_grey_med
          display: block
          margin: 0 auto 10px

    .thumbnail
      figure
        min-height: 150px
        &:first-of-type
          background: cabin_grey_light
          float: left
          margin-right: 20px
          min-height: 320px
          width: 540px
        img
          // Stack img on top of figcaption.
          position: relative
          width: 100%
      &.drag figure
        opacity: .5

    .services fieldset
      float: left
      margin-right: 20px
      width: 220px
      legend
        font-weight: bold
      ul
        list-style: none
        padding: 0

    .cohorts
      fieldset
        clearfix()
        input
          float: left
          margin-bottom: 10px
          margin-right: 20px
          width: 200px
        input:nth-of-type(3n + 2)
          width: 480px
        input:nth-of-type(3n + 3)
          clear: left
        .trash
          background-color: cabin_grey_med
          float: left
          margin-top: 10px
          &:hover
            background-color: cabin_black
      button
        margin-top: 10px

    .images
      margin-top: 60px
      padding-left: 0
      legend
        width: 260px
        .filename
          float: left
          max-width: 190px
          overflow: ellipsis
        .icon
          background-color: cabin_grey_med
          margin-top: 7px
          margin-left: 3px
          &:hover, &.selected
            background-color: cabin_black
      .select-multiple-files
        cursor: default  // we can't control the cursor over the input
        absolute: top 50px left
        input
          absolute: top left; right: 0; bottom: 0
          opacity: 0
      .dropper
        background: cabin_grey_light
        margin-left: 280px
        size: 540 200
        float: left
        &.drag
          outline: 1px solid cabin_grey_dark
          span
            background-color: cabin_black
          figcaption
            color: cabin_black
      .preview
        clearfix()
        clear: both
        margin-right: -20px  // make room for the last column
        padding-top: 40px
      .image, .sortable-placeholder
        float: left
        margin: 0 20px 20px 0
        position: relative
        width: 260px
        img
          transition: transform 200ms ease-in-out
          width: 100%
        legend
          absolute: top 1px left; right: 0
          background: white
          color: cabin_grey_dark
          display: none
          line-height: 30px
          text-align: right
        &:hover
          img
            transform: translate3d(0, 30px, 0)
          legend
            display: block
        &:nth-of-type(4n + 1)
          clear: left
      .sortable-placeholder
        background: cabin_grey_light

    .shortlist
      margin-top: 60px
      padding-left: 280px
      legend
        width: 260px
      textarea
        size: (540 / 2) 200

    .buttons
      margin: 80px 0 40px
      button, a
        margin-right: 10px
      .trash
        background-color: #f77
        &:hover
          background-color: cabin_black


// Assorted media queries  {{{1

// Retina images.
@media only screen and (-webkit-min-device-pixel-ratio: 1.5)
  .backgroundsize.multiplebgs body > header
    s = image-size('splash-dots.png')
    background-size: (s[0] / 2) (s[1] / 2), cover
  .page-about section.colophon .signature
    background-image: url(signed-cabin@2x.png)


// At full width, tabs and the tab-chooser are displayed horizontally. As the
// browser width decreases, first we tuck the tabs underneath the title, then
// hide the tab-chooser altogether.
@media only screen and (max-width: 1159px)
  .page-project .tabs
    border-right: none
    clear: left
    float: left
    margin-top: 40px
    margin-right: 0
    padding-right: 0
@media only screen and (max-width: 699px)
  .page-project .tab-chooser
    display: none
  .page-project .images img.shadow
    border-radius: 2px 2px 0 0


// Wrap the about page's colophon when it can no longer fit next to services.
@media only screen and (min-width: 569px) and (max-width: 1070px)
  .page-about .sections section.colophon
    clear: left
    float: left
    margin-top: 40px
    width: 100%
    p
      max-width: 640px
    // breakout
    margin-left: -200%
    margin-right: -200%
    padding-left: 200%
    padding-right: 200%


// Reshuffle and resize the about-page images when there's too little space to
// show them full size.
@media only screen and (max-width: 1100px)
  .page-about .content
    > .photo
      &.bek
        left: auto
        right: 0
        top: 40px
        transform: scale(.5) rotate(15deg)
      &.zak
        transform: scale(.7) rotate(-30deg)
@media only screen and (max-width: 940px)
  .page-about .content
    > h1
      max-width: 500px
@media only screen and (max-width: 800px)
  .page-about .content
    > .photo
      &.bek
        right: -90px
        top: 100px
      &.zak
        right: -200px
        top: -65px
        transform: scale(.6) rotate(-30deg)
@media only screen and (max-width: 680px)
  .page-about .content
    > .photo
      display: none


// When the graph's top point would be bumping into the title, add margin.
@media only screen and (max-width: 920px)
  .page-about section.graph h2
    margin-bottom: 40px


// Let the secondary error message take up the screen width when it fits.
@media only screen and (min-width: 950px)
  .page-error h2 br
    display: none


// By default there are four columns of preview images in the project admin
// page, but knock that down to three when there's not enough room.
@media only screen and (max-width: 1159px)
  .page-admin-project .preview
    .image:nth-of-type(4n + 1)
      clear: none
    .image:nth-of-type(3n + 1)
      clear: left
