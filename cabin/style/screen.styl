@import nib
@import default
@import util

cabin_black = #2b2b2b
cabin_grey_dark = #929292
cabin_grey_med = #d2d2d2
cabin_grey_light = #f2f2f2
cabin_mustard = #edbc13
default_tap_highlight_color = rgba(26, 26, 26, 0.3)
headline_size = 30px
headline_lh = 1.33
headline_height = headline_size * headline_lh


// Common  ///////////////////////////////////////////////////////////////////

body
  color: cabin_black
  font: 13px/1.23 ProximaNova, Helvetica Neue, Helvetica, sans-serif

a
  text-decoration: none

.headline-text
  font: headline_size/headline_lh 'YWFT Ultramagnetic Light'
  text-transform: uppercase

.small-header-text
  font-weight: bold
  text-transform: uppercase

.dim-text
  color: cabin_grey_dark
  font-weight: normal

h1
  @extend .headline-text
  margin: 30px 0

button
  height = 28
  @extend .small-header-text
  background: cabin_grey_light
  border: none
  border-radius: 2px
  line-height: 26px
  padding: height - @line-height 12px 0
  border: 1px solid transparent
  &[type="submit"]
    light-text()
    background: cabin_black
    color: white
  &:hover
    background: white
    border-color: black
    color: cabin_black

// Set the overall page width either to a set value (if passed a single
// argument) or bounded between min and max widths (with two arguments).
page-width(args...)
  nav, .content
    if length(args) == 1
      width: args[0]
    else
      min-width: args[0]
      max-width: args[1]

hover-hr(duration = 200ms)
  position: relative
  hr
    absolute: top left
    background: cabin_black
    border: none
    margin: 0
    size: 0 1px
    transition: width duration
  .no-touch &:hover hr
    width: 100%


// Common nav/splash goodies  ////////////////////////////////////////////////

body > header
  absolute: top left
  right: 0
  display: none
  padding-top: 15%
  color: white
  light-text()

  h1, h2
    margin: 0 auto
    text-align: center
  h1
    font-size: 100px
  h2
    border-top: 1px solid rgba(white, .2)
    font: bold italic 25px/30px Georgia
    margin-top: 20px
    max-width: 80%
    padding-top: 20px
    width: 420px

nav
  background: white
  fixed: top left
  right: 0
  user-select: none
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0)
  a
    -webkit-tap-highlight-color: default_tap_highlight_color
  z-index: 2
  .logo
    hide-text()
    background-image: url('cabin-symbol.svg')
    background-repeat: no-repeat
    .no-svg &
      background-image: url('cabin-symbol.png')
  .links a
    color: cabin_black
    @extend .small-header-text

// Make sure the main content is tall enough to cover the splash during
// transitions, and set up its initial position so animation works.
html, body
  height: 100%
.main
  background: white
  box-sizing: border-box
  min-height: 100%
  relative: top
// Avoid page-width jump.
body
  overflow-y: scroll

body.splash
  > header
    display: block
  .main
    absolute: bottom left; top: auto
    height: 0
    min-height: @height
    padding-bottom: 0
    width: 100%
    > hr
      position: absolute
  nav
    position: absolute
  .content, footer
    display: none

// Show everyone while transitioning.
body.splash-transition
  nav
    position: absolute
  .main
    height: auto
    > hr
      position: absolute
  > header, .content
    display: block


// XXX temporary animation
.loading nav .logo
  animation: rotate 750ms infinite ease-out
  transform-origin: center 60%
@keyframes rotate
  from
    transform: rotate(0deg)
  to
    transform: rotate(360deg)

// XXX tmp
.main
  .content
    clearfix()
    margin: 0 auto


// Work page common bits  ////////////////////////////////////////////////////

.bricks
  opacity: 0
  // masonry class is added after initial layout, so we can avoid initial
  // transitions.
  &.masonry
    opacity: 1
    transition-property: opacity, height, width
    &, .masonry-brick
      transition-duration: 300ms
      transform: translate3D(0, 0, 0)
    .masonry-brick
      transition-property: left, right, top

.work-thumb
  space_between = 80px
  hover-hr(300ms)
  border-top: 1px solid cabin_grey_light
  color cabin_black
  display: block
  float: left
  margin-bottom: (space_between / 2)
  margin-right: 20px
  padding-top: 14px
  padding-bottom: (space_between / 2)
  width: 260px

  h2, h3
    font-size 1em
    margin: 0
  h2
    @extend .small-header-text
  h3
    @extends .dim-text
    margin-bottom: 26px
  img
    margin: 0 auto
    display: block
    max-width: 100%
    height: auto


// iPhone 5 landscape and smaller  ///////////////////////////////////////////

@media only screen and (max-width: 568px)
  nav_height = 40px

  nav
    border-bottom: 1px solid cabin_grey_light
    display: table
    width: 100%
    height: nav_height
    line-height: @height

    .logo
      background-size: 18px 15px
      background-position: center 12px
      display: table-cell
      text-indent: -999px
      width: 25%
    .links
      display: table
      table-layout: fixed
      width: 100%
      a
        border-left: 1px solid cabin_grey_light
        display: table-cell
        text-align: center
    .toggle, .social, hr
      display: none

  body > header
    bottom: nav_height
  .main
    padding-top: nav_height
  .content
    padding: 0 20px

  .main > hr, footer
    display: none

  extend-borders(page_padding = 20px)
    padding-left: page_padding
    padding-right: page_padding
    margin-left: -(page_padding)
    margin-right: -(page_padding)

  .single-column .work-thumb
    extend-borders()


// Larger than iPhone 5 landscape  ///////////////////////////////////////////

@media only screen and (min-width: 569px)
  nav_height = 90px
  footer_height = 60px

  nav
    height: (nav_height / 3)
    line-height: @height
    padding: @height
    margin: 0 auto

    .logo
      background-size: 35px 30px
      float: left
      size: 35px 30px
    .links
      float: right
      overflow: hidden
      position: relative
      > a
        hover-hr()
        float: left
        margin-right: 20px
        width: 60px

    .social
      transition_duration = 400ms
      absolute: left 100% top
      background: white
      transition: left transition_duration
      white-space: nowrap
      width: 100%
      a
        background-color: cabin_black
        float: left
        margin-right: 10px
        relative: left 100% top
        transition: left transition_duration ease transition_duration
        &:hover
          background-color: cabin_grey_dark
      a:first-child
        left: 0
    // Inside the toggle is a `b` used for creating a little border on hover,
    // and a `span` element for holding the plus image so it can be rotated
    // independently of the container.
    .toggle
      padding = 10px
      absolute: right (nav_height / 3 - padding) top (nav_height / 3)
      background: white
      border-left: 1px solid white
      padding: 0 padding
      transition: border-color 500ms
      .no-touch &:hover
        border-color: cabin_grey_med
      span
        hide-text()
        text-indent: -999em
        img = 'icons/plus@2x.png'
        background-image: url(img)
        size: (image-size(img)[0] / 2) (image-size(img)[1] / 2)
        background-size: @width @height
        display: inline-block
        transition: transform 250ms ease-in-out 200ms
      &.transitioning
        transition-delay: 400ms
    .touch & .toggle
      &.transitioning
        border-color: cabin_grey_med
        transition-delay: 0

    &.show-social
      .social
        &, a
          left: 0
          transition-delay: 0
        a:nth-child(2)
          transition-delay: 100ms
        a:nth-child(3)
          transition-delay: 200ms
        a:nth-child(4)
          transition-delay: 300ms
        a:nth-child(5)
          transition-delay: 400ms
      .toggle span
        transform: rotate(45deg)

  body > header
    bottom: nav_height
  .main
    padding: 0 30px
    padding-top: nav_height
    > hr
      background: cabin_grey_light
      border: none
      height: 1px
      margin: 0
  .content
    padding: 0 30px

  .main
    padding-bottom: footer_height + 40px

  .main > hr
    absolute: top nav_height left
    background: cabin_grey_light
    border: none
    height: 1px
    margin: 0
    width: 100%
    z-index: 2

  footer
    absolute: bottom left; right: 0
    background: cabin_grey_light
    box-shadow: inset 0 2px 2px -2px cabin_grey_dark
    height: footer_height
    line-height: @height
    overflow: hidden
    padding: 0 30px
    &, a
      color: cabin_grey_dark
    span
      color: cabin_grey_med
      display: inline-block
      margin: 0 5px
    ol
      inline-list()
    .copyright
      float: right
      margin: 0
      text-transform: uppercase


  // Work list page  ///////////////////////////////

  .work-thumb
    &.feature
      width: 540px
    // Cover the top border with the hover-hr.
    hr
      top: -1px


  // Admin  ////////////////////////////////////////
  // TODO: Consider pulling this out into its own stylesheet; load it only if
  // the user is logged in.

  .page-admin-project
    page-width(940px, 1100px)

    form *
      box-sizing: border-box

    .header
      clearfix()
      h1
        float: left
      aside
        float: right
        margin: headline_height 0

    input[type="text"], textarea, figure
      background: cabin_grey_light
      border: 1px solid transparent
      box-shadow: inset 1px 1px 1px 0 rgba(cabin_grey_dark, .2)
      display: block
      outline: none
      padding: 10px
      &:focus
        border-color: cabin_grey_dark
    textarea
      resize: none
    ::-webkit-input-placeholder
      light-text()
      color: cabin_grey_med

    fieldset
      border: none
      margin: 0
      padding: 0
    form > fieldset
      margin-bottom: 20px
      padding-left: 120px
      position: relative
      > legend
        absolute: top left
        border-top: 1px solid cabin_black
        font-weight: bold
        line-height: 30px
        text-transform: uppercase
        width: 80px

    [name="title"]
      font: headline_size/headline_lh 'YWFT Ultramagnetic Light'
      text-transform: uppercase
      size: 300 100
      float: left
    [name="type"], [name="slug"]
      float: left
      width: 940px - 120 - 300 - 20
      margin-left: 20px
    [name="type"]
      margin-bottom: 100px - 38 * 2
    [name="brief"]
      margin-bottom: 10px
      size: 750 150
    [name="external_url"]
      width: 420px

    .thumbnail
      figure
        background: cabin_grey_med
        border: none
        display: inline-block
        min-height: 150px
        padding: 0
        position: relative
        width: 260px
        &:first-of-type
          background: cabin_grey_light
          float: left
          margin-right: 20px
          min-height: 320px
          width: 540px
        figcaption
          light-text()
          color: cabin_grey_med
          absolute: top 50% left 50%
        img
          // Stack img on top of figcaption.
          position: relative
          width: 100%
      &.drag figure
        // XXX better styles here plz
        opacity: .5

    .services fieldset
      font-size: 15px
      float: left
      margin-right: 20px
      width: 220px
      legend
        font-weight: bold
      ul
        list-style: none
        padding: 0
      li
        line-height: 22px;


// Neither CSS nor Stylus reliably supports nested media queries, so here we go
// with Retina images.  XXX it works if you use a & immediately inside the nest
// XXX having these here along with inlined images penalizes all devices
/*
@media only screen and (max-width: 568px) and (-webkit-min-device-pixel-ratio: 1.5)
  nav .logo
    background-image: url('symbol-white@2x.png')

@media only screen and (min-width: 569px) and (-webkit-min-device-pixel-ratio: 1.5)
  nav .logo
    background-image: url('symbol-black@2x.png')
    .no-touch &:hover
      background-image: url('symbol-hover@2x.png')
*/
