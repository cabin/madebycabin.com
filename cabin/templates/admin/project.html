{% extends 'base.html' %}
{% set title = 'Create Project' if is_new else 'Edit Project' %}
{% set page = 'admin-project' %}

{% macro render(field) %}
  {%- if field.errors %}
    {% set field_title = ' '.join(field.errors) %}
    {% set field_class = ('error ' + kwargs.pop('class', '')).strip() %}
  {% endif -%}
  {{ field(placeholder=field.description or field.label.text,
           title=field_title,
           class=field_class,
           **kwargs) -}}
{% endmacro %}

{% block content %}
  <form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}

    <div class="header">
      <h1>{{ title }}</h1>

      <aside>
        {{ render(form.is_public, class='icon public') }}
        {{ render(form.is_featured, class='icon feature') }}
        <button type="submit">Save</button>
      </aside>
    </div>

    <fieldset>
      <legend>Name</legend>
      {{ render(form.title) }}
      {{ render(form.type) }}
      {{ render(form.slug) }}
    </fieldset>

    <fieldset class="thumbnail">
      <legend>Thumbnail</legend>
      <figure{% if form.thumbnail_file.errors %} class="error"{% endif %}>
        <figcaption>
          <span class="icon image-upload"></span>
          Add thumbnail (540 &times; N)
        </figcaption>
        {% if form.thumbnail_file.data %}
          <img src="{{ image_url(form.thumbnail_file.data) }}" alt>
        {% endif %}
      </figure>
      <figure>
        {% if form.thumbnail_file.data %}
          <img src="{{ image_url(form.thumbnail_file.data) }}" alt>
        {% endif %}
      </figure>
    </fieldset>

    <fieldset>
      <legend>Brief</legend>
      {{ render(form.brief) }}
      {{ render(form.external_url) }}
    </fieldset>

    <fieldset class="services">
      <legend>Services</legend>
      {{ form.services }}
    </fieldset>

    <fieldset class="cohorts">
      <legend>Cohorts</legend>
      {% for cohort in form.cohorts %}
        <fieldset class="cohort" data-prefix="{{ cohort.name }}">
          {{ render(cohort.form.name) }}
          {{ render(cohort.form.role) }}
          {{ render(cohort.form.url) }}
          <a class="icon trash">Delete</a>
        </fieldset>
      {% endfor %}
      <button>Add cohort</button>
    </fieldset>

    <fieldset class="shortlist">
      <legend>Development Shortlist</legend>
      {{ render(form.dev_shortlist) }}
    </fieldset>

    <fieldset class="images">
      <legend>Project images</legend>
      <a class="select-multiple-files button">
        Select files
        <input type="file" multiple>
      </a>
      <div class="checkbox">
        {{ form.is_slideshow }} {{ form.is_slideshow.label }}
      </div>
      <figure class="dropper">
        <figcaption><span class="icon image-upload"></span>
        Drag &amp; drop project images
      </figure>

      <div class="preview"></div>
      <script>
        // Form elements for these are handled in JS.
        var imageUrlPrefix = {{ image_url('')|tojson|safe }};
        var projectImages = {{ form.images.data|tojson|safe }};
      </script>
    </fieldset>

    <div class="buttons">
      <button type="submit">Save it bitches!</button>
      {% if is_new %}
        <a class="button" href="{{ url_for('main.work') }}">Cancel</a>
      {% else %}
        <a class="button" href="{{ url_for('main.project', slug=form.slug.data) }}">Cancel</a>
      {% endif %}
      <a class="icon trash">Delete</a>
    </div>
  </form>
{% endblock %}
